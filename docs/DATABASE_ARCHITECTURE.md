# üìä Documentaci√≥n de Base de Datos - Well Wizards SaaS

## üèóÔ∏è Arquitectura General

Este documento describe la estructura completa de la base de datos PostgreSQL para el sistema Well Wizards SaaS, incluyendo todas las tablas, campos obligatorios, relaciones y constraints.

## üìã √çndice de Tablas

1. [User](#user) - Usuarios del sistema
2. [Account](#account) - Cuentas de autenticaci√≥n (NextAuth)
3. [Session](#session) - Sesiones de usuario (NextAuth)
4. [VerificationToken](#verificationtoken) - Tokens de verificaci√≥n (NextAuth)
5. [Client](#client) - Clientes/Empresas
6. [Contract](#contract) - Contratos de perforaci√≥n
7. [Field](#field) - Campos petrol√≠feros
8. [Well](#well) - Pozos de petr√≥leo/gas
9. [DrillingPlan](#drillingplan) - Plan de perforaci√≥n
10. [DrillingData](#drillingdata) - Datos reales de perforaci√≥n
11. [ProductionData](#productiondata) - Datos de producci√≥n
12. [ContractActivity](#contractactivity) - Actividades del contrato
13. [Report](#report) - Reportes generados

---

## üìù Detalle de Tablas

### User
**Prop√≥sito**: Gesti√≥n de usuarios del sistema con autenticaci√≥n y roles.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del usuario |
| `name` | String | ‚ùå | null | Nombre completo del usuario |
| `email` | String | ‚úÖ | - | Email √∫nico para login |
| `password` | String | ‚úÖ | - | Password hasheado |
| `emailVerified` | DateTime | ‚ùå | null | Fecha de verificaci√≥n de email |
| `image` | String | ‚ùå | null | URL de avatar/foto |
| `role` | String | ‚ùå | "user" | Rol: admin, user, viewer |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Constraints**:
- `email` debe ser √∫nico
- `role` valores permitidos: admin, user, viewer

**Relaciones**:
- `accounts[]` ‚Üí Account (1:N)
- `sessions[]` ‚Üí Session (1:N)
- `wells[]` ‚Üí Well (1:N)
- `contracts[]` ‚Üí Contract (1:N)
- `reports[]` ‚Üí Report (1:N)

---

### Account
**Prop√≥sito**: Cuentas de autenticaci√≥n externa (NextAuth.js - OAuth providers).

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico de la cuenta |
| `userId` | String | ‚úÖ | - | FK hacia User |
| `type` | String | ‚úÖ | - | Tipo de cuenta (oauth, email) |
| `provider` | String | ‚úÖ | - | Proveedor (google, github, etc.) |
| `providerAccountId` | String | ‚úÖ | - | ID en el proveedor |
| `refresh_token` | String | ‚ùå | null | Token de refresco |
| `access_token` | String | ‚ùå | null | Token de acceso |
| `expires_at` | Int | ‚ùå | null | Timestamp de expiraci√≥n |
| `token_type` | String | ‚ùå | null | Tipo de token |
| `scope` | String | ‚ùå | null | Alcance del token |
| `id_token` | String | ‚ùå | null | ID token |
| `session_state` | String | ‚ùå | null | Estado de sesi√≥n |

**Constraints**:
- `[provider, providerAccountId]` debe ser √∫nico
- FK: `userId` ‚Üí User.id (CASCADE)

---

### Session
**Prop√≥sito**: Sesiones activas de usuarios (NextAuth.js).

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico de sesi√≥n |
| `sessionToken` | String | ‚úÖ | - | Token √∫nico de sesi√≥n |
| `userId` | String | ‚úÖ | - | FK hacia User |
| `expires` | DateTime | ‚úÖ | - | Fecha de expiraci√≥n |

**Constraints**:
- `sessionToken` debe ser √∫nico
- FK: `userId` ‚Üí User.id (CASCADE)

---

### VerificationToken
**Prop√≥sito**: Tokens para verificaci√≥n de email y reset de password.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `identifier` | String | ‚úÖ | - | Identificador (email) |
| `token` | String | ‚úÖ | - | Token √∫nico |
| `expires` | DateTime | ‚úÖ | - | Fecha de expiraci√≥n |

**Constraints**:
- `token` debe ser √∫nico
- `[identifier, token]` debe ser √∫nico

---

### Client
**Prop√≥sito**: Empresas clientes que contratan servicios de perforaci√≥n.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del cliente |
| `name` | String | ‚úÖ | - | Nombre de la empresa |
| `email` | String | ‚ùå | null | Email de contacto |
| `phone` | String | ‚ùå | null | Tel√©fono de contacto |
| `address` | String | ‚ùå | null | Direcci√≥n f√≠sica |
| `logo` | String | ‚ùå | null | URL del logo |
| `contactName` | String | ‚ùå | null | Nombre del contacto |
| `contactEmail` | String | ‚ùå | null | Email del contacto |
| `contactPhone` | String | ‚ùå | null | Tel√©fono del contacto |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Relaciones**:
- `contracts[]` ‚Üí Contract (1:N)

---

### Contract
**Prop√≥sito**: Contratos de perforaci√≥n entre cliente y empresa.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del contrato |
| `name` | String | ‚úÖ | - | Nombre del contrato |
| `description` | String | ‚ùå | null | Descripci√≥n detallada |
| `startDate` | DateTime | ‚úÖ | - | Fecha de inicio |
| `endDate` | DateTime | ‚úÖ | - | Fecha de finalizaci√≥n |
| `value` | Float | ‚úÖ | - | Valor monetario del contrato |
| `currency` | String | ‚ùå | "USD" | Moneda del contrato |
| `status` | String | ‚ùå | "active" | Estado del contrato |
| `conditions` | String | ‚ùå | null | Condiciones especiales |
| `terms` | String | ‚ùå | null | T√©rminos y condiciones |
| `logo` | String | ‚ùå | null | Logo espec√≠fico |
| `contractType` | String | ‚ùå | "drilling" | Tipo de contrato |
| `drillingConfig` | String | ‚ùå | null | Configuraci√≥n JSON |
| `targetDepth` | Float | ‚ùå | null | Profundidad objetivo (m) |
| `expectedDays` | Int | ‚ùå | null | D√≠as esperados |
| `dailyRate` | Float | ‚ùå | null | Tarifa diaria |
| `bonusStructure` | String | ‚ùå | null | Estructura de bonos |
| `clientId` | String | ‚úÖ | - | FK hacia Client |
| `userId` | String | ‚úÖ | - | FK hacia User responsable |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Constraints**:
- `status` valores: active, completed, cancelled, suspended
- `contractType` valores: drilling, completion, workover
- FK: `clientId` ‚Üí Client.id (CASCADE)
- FK: `userId` ‚Üí User.id (CASCADE)

**Relaciones**:
- `client` ‚Üí Client (N:1)
- `user` ‚Üí User (N:1)
- `fields[]` ‚Üí Field (1:N)
- `activities[]` ‚Üí ContractActivity (1:N)

---

### Field
**Prop√≥sito**: Campos petrol√≠feros donde se ubican los pozos.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del campo |
| `name` | String | ‚úÖ | - | Nombre del campo |
| `location` | String | ‚úÖ | - | Ubicaci√≥n geogr√°fica |
| `description` | String | ‚ùå | null | Descripci√≥n del campo |
| `latitude` | Float | ‚ùå | null | Coordenada latitud |
| `longitude` | Float | ‚ùå | null | Coordenada longitud |
| `contractId` | String | ‚úÖ | - | FK hacia Contract |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Constraints**:
- FK: `contractId` ‚Üí Contract.id (CASCADE)

**Relaciones**:
- `contract` ‚Üí Contract (N:1)
- `wells[]` ‚Üí Well (1:N)

---

### Well
**Prop√≥sito**: Pozos de petr√≥leo/gas con informaci√≥n t√©cnica completa.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del pozo |
| `name` | String | ‚úÖ | - | Nombre del pozo |
| `location` | String | ‚úÖ | - | Ubicaci√≥n del pozo |
| `status` | String | ‚ùå | "active" | Estado del pozo |
| `production` | Float | ‚ùå | 0 | Producci√≥n actual |
| `pressure` | Float | ‚ùå | 0 | Presi√≥n actual (psi) |
| `temperature` | Float | ‚ùå | 0 | Temperatura actual (¬∞F) |
| `lastMaintenance` | DateTime | ‚ùå | null | √öltimo mantenimiento |
| `depth` | Float | ‚ùå | null | Profundidad total (m) |
| `diameter` | Float | ‚ùå | null | Di√°metro (pulgadas) |
| `wellType` | String | ‚ùå | null | Tipo: vertical, horizontal, direccional |
| `latitude` | Float | ‚ùå | null | Coordenada latitud |
| `longitude` | Float | ‚ùå | null | Coordenada longitud |

**Campos T√©cnicos Avanzados**:
| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `formation` | String | ‚ùå | null | Formaci√≥n geol√≥gica |
| `holeSection` | String | ‚ùå | null | Secci√≥n: surface, intermediate, production |
| `operation` | String | ‚ùå | null | Operaci√≥n: drilling, completion, testing, production |
| `mudType` | String | ‚ùå | null | Tipo de lodo |
| `mudDensity` | Float | ‚ùå | null | Densidad del lodo (ppg) |
| `casingSize` | String | ‚ùå | null | Tama√±o de casing |
| `drillPipeSize` | String | ‚ùå | null | Tama√±o de drill pipe |
| `bitType` | String | ‚ùå | null | Tipo de broca |
| `bitSize` | Float | ‚ùå | null | Tama√±o de broca (pulgadas) |
| `flowRate` | Float | ‚ùå | null | Caudal de bomba (gpm) |
| `rotarySpeed` | Float | ‚ùå | null | Velocidad de rotaci√≥n (rpm) |
| `weightOnBit` | Float | ‚ùå | null | Peso sobre la broca (klbs) |
| `torque` | Float | ‚ùå | null | Torque (ft-lbs) |
| `standpipePressure` | Float | ‚ùå | null | Presi√≥n en standpipe (psi) |

**Campos Adicionales**:
| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `userId` | String | ‚úÖ | - | FK hacia User responsable |
| `fieldId` | String | ‚ùå | null | FK hacia Field |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Constraints**:
- `wellType` valores: vertical, horizontal, direccional
- `operation` valores: drilling, completion, testing, production
- FK: `userId` ‚Üí User.id (CASCADE)
- FK: `fieldId` ‚Üí Field.id (SET NULL)

**Relaciones**:
- `user` ‚Üí User (N:1)
- `field` ‚Üí Field (N:1)
- `productionData[]` ‚Üí ProductionData (1:N)
- `drillingData[]` ‚Üí DrillingData (1:N)
- `drillingPlan[]` ‚Üí DrillingPlan (1:N)

---

### DrillingPlan
**Prop√≥sito**: Plan detallado de perforaci√≥n por d√≠as con objetivos y par√°metros.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del plan |
| `wellId` | String | ‚úÖ | - | FK hacia Well |
| `day` | Int | ‚úÖ | - | D√≠a planificado (1, 2, 3...) |
| `depthFrom` | Float | ‚úÖ | - | Profundidad inicial (m) |
| `depthTo` | Float | ‚úÖ | - | Profundidad objetivo (m) |
| `plannedROP` | Float | ‚úÖ | - | ROP planificado (m/hr) |
| `plannedHours` | Float | ‚úÖ | - | Horas planificadas |
| `formation` | String | ‚ùå | null | Formaci√≥n esperada |
| `holeSection` | String | ‚ùå | null | Secci√≥n del hoyo |
| `operation` | String | ‚ùå | null | Operaci√≥n planificada |
| `mudType` | String | ‚ùå | null | Tipo de lodo planificado |
| `mudDensity` | Float | ‚ùå | null | Densidad planificada |
| `bitType` | String | ‚ùå | null | Tipo de broca planificada |
| `bitSize` | Float | ‚ùå | null | Tama√±o de broca |
| `flowRate` | Float | ‚ùå | null | Caudal planificado (gpm) |
| `rotarySpeed` | Float | ‚ùå | null | RPM planificado |
| `weightOnBit` | Float | ‚ùå | null | WOB planificado (klbs) |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Constraints**:
- FK: `wellId` ‚Üí Well.id (CASCADE)
- `day` debe ser > 0
- `depthTo` debe ser > `depthFrom`

**Relaciones**:
- `well` ‚Üí Well (N:1)

---

### DrillingData
**Prop√≥sito**: Datos reales de perforaci√≥n registrados diariamente.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del registro |
| `wellId` | String | ‚úÖ | - | FK hacia Well |
| `date` | DateTime | ‚úÖ | now() | Fecha del registro |
| `day` | Int | ‚úÖ | - | D√≠a de perforaci√≥n |
| `depth` | Float | ‚úÖ | - | Profundidad alcanzada (m) |
| `plan` | Float | ‚ùå | null | Profundidad planeada (m) |
| `progressM` | Float | ‚ùå | null | Progreso en metros |
| `rop` | Float | ‚ùå | null | Rate of Penetration real |
| `mud` | String | ‚ùå | null | Tipo de lodo usado |
| `pressure` | Float | ‚ùå | null | Presi√≥n (psi) |
| `temperature` | Float | ‚ùå | null | Temperatura (¬∞F) |
| `status` | String | ‚ùå | "drilling" | Estado de la operaci√≥n |
| `shift` | String | ‚ùå | "day" | Turno: day, night |
| `crew` | String | ‚ùå | null | Equipo de trabajo |
| `contractor` | String | ‚ùå | null | Contratista |
| `formation` | String | ‚ùå | null | Formaci√≥n actual |
| `holeSection` | String | ‚ùå | null | Secci√≥n del hoyo |
| `operation` | String | ‚ùå | null | Operaci√≥n espec√≠fica |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Constraints**:
- FK: `wellId` ‚Üí Well.id (CASCADE)
- `status` valores: drilling, tripping, maintenance, waiting
- `shift` valores: day, night

**Relaciones**:
- `well` ‚Üí Well (N:1)

---

### ProductionData
**Prop√≥sito**: Datos de producci√≥n del pozo.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del registro |
| `wellId` | String | ‚úÖ | - | FK hacia Well |
| `production` | Float | ‚úÖ | - | Producci√≥n registrada |
| `pressure` | Float | ‚úÖ | - | Presi√≥n registrada |
| `temperature` | Float | ‚úÖ | - | Temperatura registrada |
| `recordDate` | DateTime | ‚úÖ | now() | Fecha del registro |

**Constraints**:
- FK: `wellId` ‚Üí Well.id (CASCADE)

**Relaciones**:
- `well` ‚Üí Well (N:1)

---

### ContractActivity
**Prop√≥sito**: Actividades espec√≠ficas definidas en cada contrato.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico de la actividad |
| `contractId` | String | ‚úÖ | - | FK hacia Contract |
| `name` | String | ‚úÖ | - | Nombre de la actividad |
| `description` | String | ‚ùå | null | Descripci√≥n detallada |
| `category` | String | ‚úÖ | - | Categor√≠a de actividad |
| `unit` | String | ‚úÖ | - | Unidad de medida |
| `targetValue` | Float | ‚úÖ | - | Valor objetivo |
| `priority` | Int | ‚ùå | 1 | Prioridad (1-5) |
| `isActive` | Boolean | ‚ùå | true | Estado activo |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Constraints**:
- FK: `contractId` ‚Üí Contract.id (CASCADE)
- `category` valores: drilling, completion, testing, maintenance
- `unit` valores: meters, hours, days, pieces
- `priority` rango: 1-5

**Relaciones**:
- `contract` ‚Üí Contract (N:1)

---

### Report
**Prop√≥sito**: Reportes generados por el sistema.

| Campo | Tipo | Obligatorio | Default | Descripci√≥n |
|-------|------|-------------|---------|-------------|
| `id` | String | ‚úÖ | cuid() | ID √∫nico del reporte |
| `title` | String | ‚úÖ | - | T√≠tulo del reporte |
| `description` | String | ‚ùå | null | Descripci√≥n del reporte |
| `reportType` | String | ‚úÖ | - | Tipo de reporte |
| `format` | String | ‚úÖ | - | Formato del archivo |
| `status` | String | ‚ùå | "generated" | Estado del reporte |
| `generatedBy` | String | ‚úÖ | - | FK hacia User que gener√≥ |
| `generatedAt` | DateTime | ‚úÖ | now() | Fecha de generaci√≥n |
| `createdAt` | DateTime | ‚úÖ | now() | Fecha de creaci√≥n |
| `updatedAt` | DateTime | ‚úÖ | auto | Fecha de actualizaci√≥n |

**Constraints**:
- FK: `generatedBy` ‚Üí User.id (CASCADE)
- `reportType` valores: daily, weekly, monthly, custom, comparative
- `format` valores: pdf, excel, csv
- `status` valores: generated, sent, archived

**Relaciones**:
- `user` ‚Üí User (N:1)

---

## üîó Diagrama de Relaciones

```
User (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (N) Contract ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (1) Client
  ‚îÇ                     ‚îÇ
  ‚îÇ                     ‚îî‚îÄ‚îÄ (1:N) Field ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (1:N) Well
  ‚îÇ                                                 ‚îÇ
  ‚îÇ                                                 ‚îú‚îÄ‚îÄ (1:N) DrillingPlan
  ‚îÇ                                                 ‚îú‚îÄ‚îÄ (1:N) DrillingData  
  ‚îÇ                                                 ‚îî‚îÄ‚îÄ (1:N) ProductionData
  ‚îÇ
  ‚îú‚îÄ‚îÄ (1:N) Session
  ‚îú‚îÄ‚îÄ (1:N) Account
  ‚îî‚îÄ‚îÄ (1:N) Report
```

## üìã Campos Obligatorios por Tabla (Para INSERT)

### M√≠nimos requeridos para cada tabla:

**User**: `id`, `email`, `name`, `password`  
**Client**: `id`, `name`  
**Contract**: `id`, `name`, `startDate`, `endDate`, `value`, `clientId`, `userId`  
**Field**: `id`, `name`, `location`, `contractId`  
**Well**: `id`, `name`, `location`, `userId`  
**DrillingPlan**: `wellId`, `day`, `depthFrom`, `depthTo`, `plannedROP`, `plannedHours`  
**DrillingData**: `wellId`, `day`, `date`, `depth`

---

## üöÄ Scripts de Ejemplo

### Orden correcto para INSERT (respetar foreign keys):
1. User
2. Client  
3. Contract (requiere User + Client)
4. Field (requiere Contract)
5. Well (requiere User + Field)
6. DrillingPlan (requiere Well)
7. DrillingData (requiere Well)

### Orden correcto para DELETE (inverso):
1. DrillingData
2. DrillingPlan
3. ProductionData
4. Well
5. Field
6. Contract
7. Client
8. User (solo los que no son del sistema)

---

*Documentaci√≥n generada el 4 de octubre de 2025*
*Versi√≥n: 1.0*